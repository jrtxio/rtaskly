# Taskly重构计划

## 1. 重构目标

- 将界面和核心逻辑分离，提高代码可维护性
- 使用SQLite替代JSON文件存储
- 实现PRD中要求的所有功能
- 优化代码结构，便于后续扩展

## 2. 重构方案

### 2.1 代码结构设计

```
rreminder/
├── main.rkt              # 程序入口
├── core/
│   ├── database.rkt      # SQLite数据库操作
│   ├── task.rkt          # 任务业务逻辑
│   └── list.rkt          # 列表业务逻辑
├── gui/
│   ├── main-frame.rkt    # 主窗口
│   ├── sidebar.rkt       # 侧边栏组件
│   ├── task-panel.rkt    # 任务展示面板
│   └── dialogs.rkt       # 各种对话框
└── utils/
    ├── date.rkt          # 日期处理工具
    └── path.rkt          # 路径管理工具
```

### 2.2 核心功能实现

1. **数据文件管理**
   - 首次启动时选择或创建SQLite文件
   - 支持切换数据文件

2. **SQLite数据库**
   - 创建任务列表表(`list`)和任务表(`task`)
   - 实现CRUD操作

3. **界面重构**
   - 左侧菜单栏：搜索框、智能列表、自定义列表
   - 右侧任务展示区：任务列表、添加任务按钮
   - 各种对话框：添加/编辑列表、添加/编辑任务

4. **功能实现**
   - 任务增删改查
   - 列表增删改查
   - 智能筛选（今天/计划/全部/完成）
   - 按列表筛选任务

### 2.3 实现步骤

1. **创建项目结构**：创建上述目录结构和基础文件
2. **实现数据库模块**：SQLite连接、表创建、CRUD操作
3. **实现业务逻辑**：任务和列表的业务逻辑
4. **重构界面组件**：将界面代码拆分为多个组件
5. **实现主程序入口**：整合所有模块
6. **测试和优化**：确保功能正常，优化用户体验

## 3. 技术要点

- 使用`racket/sqlite3`处理数据库操作
- 使用`racket/gui`构建界面
- 采用模块化设计，便于维护和扩展
- 实现数据迁移，兼容现有JSON数据（可选）

## 4. 预期效果

- 代码结构清晰，界面和逻辑分离
- 支持SQLite存储，用户可自定义数据文件路径
- 实现PRD中要求的所有功能
- 界面简洁、操作流畅
- 便于后续扩展新功能